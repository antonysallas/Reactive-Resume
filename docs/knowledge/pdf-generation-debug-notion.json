{
  "parent": {
    "page_id": "1fba94d4-8e10-81d0-8d9d-fd8dd1ed9355"
  },
  "properties": {
    "title": {
      "title": [
        {
          "text": {
            "content": "PDF Generation Issue: 307 HTTPS Redirect Bug"
          }
        }
      ]
    }
  },
  "children": [
    {
      "object": "block",
      "type": "heading_1",
      "heading_1": {
        "rich_text": [
          {
            "type": "text",
            "text": {
              "content": "PDF Generation Issue: 307 HTTPS Redirect Bug"
            }
          }
        ]
      }
    },
    {
      "object": "block",
      "type": "paragraph",
      "paragraph": {
        "rich_text": [
          {
            "type": "text",
            "text": {
              "content": "Date: May 22, 2025\nStatus: Investigation Completed\nSeverity: High - PDF generation completely broken"
            }
          }
        ]
      }
    },
    {
      "object": "block",
      "type": "heading_2",
      "heading_2": {
        "rich_text": [
          {
            "type": "text",
            "text": {
              "content": "Problem Summary"
            }
          }
        ]
      }
    },
    {
      "object": "block",
      "type": "paragraph",
      "paragraph": {
        "rich_text": [
          {
            "type": "text",
            "text": {
              "content": "PDF generation fails with SSL protocol error. Chrome browser container successfully accesses http://app:3000/artboard/preview but receives a 307 redirect to https://app:3000/artboard/preview, which then fails with net::ERR_SSL_PROTOCOL_ERROR since the app doesn't serve HTTPS."
            }
          }
        ]
      }
    },
    {
      "object": "block",
      "type": "heading_2",
      "heading_2": {
        "rich_text": [
          {
            "type": "text",
            "text": {
              "content": "Technical Analysis"
            }
          }
        ]
      }
    },
    {
      "object": "block",
      "type": "bulleted_list_item",
      "bulleted_list_item": {
        "rich_text": [
          {
            "type": "text",
            "text": {
              "content": "Error Flow: HTTP GET → 307 Redirect → HTTPS GET → SSL Error → chrome-error://chromewebdata/"
            }
          }
        ]
      }
    },
    {
      "object": "block",
      "type": "bulleted_list_item",
      "bulleted_list_item": {
        "rich_text": [
          {
            "type": "text",
            "text": {
              "content": "Chrome logs show the server is sending the 307 redirect, not Chrome itself"
            }
          }
        ]
      }
    },
    {
      "object": "block",
      "type": "bulleted_list_item",
      "bulleted_list_item": {
        "rich_text": [
          {
            "type": "text",
            "text": {
              "content": "Issue occurs even with NODE_ENV=development and CHROME_IGNORE_HTTPS_ERRORS=true"
            }
          }
        ]
      }
    },
    {
      "object": "block",
      "type": "bulleted_list_item",
      "bulleted_list_item": {
        "rich_text": [
          {
            "type": "text",
            "text": {
              "content": "Previous changes to URL replacement logic (localhost → app) were correct but insufficient"
            }
          }
        ]
      }
    },
    {
      "object": "block",
      "type": "heading_2",
      "heading_2": {
        "rich_text": [
          {
            "type": "text",
            "text": {
              "content": "Investigation Steps Taken"
            }
          }
        ]
      }
    },
    {
      "object": "block",
      "type": "numbered_list_item",
      "numbered_list_item": {
        "rich_text": [
          {
            "type": "text",
            "text": {
              "content": "Analyzed Chrome container logs - confirmed 307 redirect from server"
            }
          }
        ]
      }
    },
    {
      "object": "block",
      "type": "numbered_list_item",
      "numbered_list_item": {
        "rich_text": [
          {
            "type": "text",
            "text": {
              "content": "Checked NestJS main.ts for production middleware (helmet) - not the cause"
            }
          }
        ]
      }
    },
    {
      "object": "block",
      "type": "numbered_list_item",
      "numbered_list_item": {
        "rich_text": [
          {
            "type": "text",
            "text": {
              "content": "Changed NODE_ENV from production to development - didn't resolve issue"
            }
          }
        ]
      }
    },
    {
      "object": "block",
      "type": "numbered_list_item",
      "numbered_list_item": {
        "rich_text": [
          {
            "type": "text",
            "text": {
              "content": "Attempted ServeStaticModule configuration changes - broke artboard serving"
            }
          }
        ]
      }
    },
    {
      "object": "block",
      "type": "numbered_list_item",
      "numbered_list_item": {
        "rich_text": [
          {
            "type": "text",
            "text": {
              "content": "Rollback completed, original configuration restored"
            }
          }
        ]
      }
    },
    {
      "object": "block",
      "type": "heading_2",
      "heading_2": {
        "rich_text": [
          {
            "type": "text",
            "text": {
              "content": "Error Logs"
            }
          }
        ]
      }
    },
    {
      "object": "block",
      "type": "code",
      "code": {
        "language": "plain_text",
        "rich_text": [
          {
            "type": "text",
            "text": {
              "content": "chrome-1 | browserless.io:ChromiumCDPWebSocketRoute:trace 10.89.0.2 GET: http://app:3000/artboard/preview\nchrome-1 | browserless.io:ChromiumCDPWebSocketRoute:trace 10.89.0.2 307: http://app:3000/artboard/preview\nchrome-1 | browserless.io:ChromiumCDPWebSocketRoute:trace 10.89.0.2 GET: https://app:3000/artboard/preview\nchrome-1 | browserless.io:ChromiumCDPWebSocketRoute:warn 10.89.0.2 \"net::ERR_SSL_PROTOCOL_ERROR\": https://app:3000/artboard/preview"
            }
          }
        ]
      }
    },
    {
      "object": "block",
      "type": "heading_2",
      "heading_2": {
        "rich_text": [
          {
            "type": "text",
            "text": {
              "content": "Next Steps for Resolution"
            }
          }
        ]
      }
    },
    {
      "object": "block",
      "type": "bulleted_list_item",
      "bulleted_list_item": {
        "rich_text": [
          {
            "type": "text",
            "text": {
              "content": "Identify middleware/configuration causing 307 redirect in NestJS"
            }
          }
        ]
      }
    },
    {
      "object": "block",
      "type": "bulleted_list_item",
      "bulleted_list_item": {
        "rich_text": [
          {
            "type": "text",
            "text": {
              "content": "Check Express.js trust proxy settings or similar middleware"
            }
          }
        ]
      }
    },
    {
      "object": "block",
      "type": "bulleted_list_item",
      "bulleted_list_item": {
        "rich_text": [
          {
            "type": "text",
            "text": {
              "content": "Verify Reverse proxy configuration in Docker/container setup"
            }
          }
        ]
      }
    },
    {
      "object": "block",
      "type": "bulleted_list_item",
      "bulleted_list_item": {
        "rich_text": [
          {
            "type": "text",
            "text": {
              "content": "Test with direct container access to bypass potential middleware"
            }
          }
        ]
      }
    }
  ]
}